::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: 
:WeekToDate %yn% %cw% %dw% yy mm dd
::
:: 作者：Ritchie Lawrence, 2002-10-04. 版本 1.0
::
:: 功能：通过 ISO 8601 星期日期获取日历日期。
::       适用于 NT4/2000/XP/2003.
:: 
:: 参数：%1 待转换的年，两位或者四位（传值调用）
::       %2 待转换的日历星期，两位，01 到 53（传值调用）
::       %3 待转换的星期的第几天，一位，1 到 7（传值调用）
::       %4 该变量用于接收年，四位（引用调用）
::       %5 该变量用于接收月，两位，范围是 01 到 12（引用调用）
::       %6 该变量用于接收日，两位，范围是 01 到 31（引用调用）
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
setlocal ENABLEEXTENSIONS
set yn=%1&set cw=%2&set dw=%3
if 1%yy% LSS 200 if 1%yy% LSS 170 (set yy=20%yy%) else (set yy=19%yy%)
set /a cw=100%cw%%%100,d=3210654
set /a z=14-1,z/=12,y=yn+4800-z,m=1+12*z-3,Jt=153*m+2
set /a Jt=Jt/5+1+y*365+y/4-y/100+y/400-32045,wt=Jt%%7
call set at=%%d:~%wt%,1%%&set /a Jt=at+Jt-3 
set /a Jt=Jt+7*cw+dw-9,a=Jt+32045,b=4*a+3,b/=146097,c=-b*146097,c/=4,c+=a
set /a d=4*c+3,d/=1461,e=-1461*d,e/=4,e+=c,m=5*e+2,m/=153,dd=153*m+2,dd/=5
set /a dd=-dd+e+1,mm=-m/10,mm*=12,mm+=m+3,yy=b*100+d-4800+m/10
(if %mm% LSS 10 set mm=0%mm%)&(if %dd% LSS 10 set dd=0%dd%)
endlocal&set %4=%yy%&set %5=%mm%&set %6=%dd%&goto :EOF
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::